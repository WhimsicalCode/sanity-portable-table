import{toPlainText as e}from"@portabletext/toolkit";import{set as n,MemberField as t,definePlugin as r}from"sanity";import{jsx as l,jsxs as o}from"react/jsx-runtime";import{useCallback as i}from"react";import{Stack as a,Card as c,Inline as s,Button as u,Text as d,Box as m}from"@sanity/ui";import{RemoveIcon as p,AddIcon as y}from"@sanity/icons";Object.prototype.hasOwnProperty.call.bind(Object.prototype.hasOwnProperty);const b=(()=>{let e;return()=>{if(e)return e;e=[];for(let n=0;n<256;++n)e[n]=(n+256).toString(16).substring(1);return e}})();function f(){const e=new Uint8Array(arguments.length>0&&void 0!==arguments[0]?arguments[0]:16);var n;return n=e,window.crypto.getRandomValues(n),e}function w(e){const n=b();return f(e).reduce(((e,t)=>e+n[t]),"").slice(0,e)}function h(e,n){return{_key:w(),_type:n.name,children:[{_key:w(),_type:"span",marks:[],text:e}],markDefs:[],style:"normal"}}function v(e,n){return{_key:w(),_type:"table-cell",text:[h(e,n)]}}function _(e,n){return{_key:w(),_type:"table-row",cells:Array.from(Array(e)).map(((e,t)=>v("Cell ".concat(t+1),n)))}}function g(e){var r;const{members:m,onChange:b,value:f,renderInput:w,cellSchema:h}=e,g=function(e,n){return e.find((e=>"field"===e.kind&&e.name===n))}(m,"rows"),k=i((()=>{const e=(null==f?void 0:f.num_cols)+1||1,t=function(){let e=arguments.length>1?arguments[1]:void 0;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((n=>{const{cells:t,...r}=n;return{...r,cells:[...t,v("Cell ".concat(t.length+1),e)]}}))}(null==f?void 0:f.rows,h);b(n({...f,rows:t,num_cols:e}))}),[b,f,h]),x=i((()=>{if(1===(null==f?void 0:f.num_cols))return;const e=(null==f?void 0:f.num_cols)-1||1,t=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((e=>{const{cells:n,...t}=e,r=[...n];return r.pop(),{...t,cells:r}}))}(null==f?void 0:f.rows);b(n({...f,rows:t,num_cols:e}))}),[b,f]),C=i((e=>w({...e,onInsert:()=>{const{rows:e,num_cols:t}=f;return b(n({...f,rows:[...e,_(t,h)]}))}})),[f,b,h,w]);return o(a,{children:[l(c,{padding:1,paddingBottom:4,children:o(s,{space:2,children:[l(u,{icon:p,mode:"ghost",onClick:x}),o(d,{children:[null!=(r=null==f?void 0:f.num_cols)?r:1," ",1===(null==f?void 0:f.num_cols)?"Column":"Columns"]}),l(u,{icon:y,tone:"primary",onClick:k})]})}),g&&l(t,{member:g,renderInput:C,renderField:e.renderField,renderItem:e.renderItem,renderPreview:e.renderPreview,renderBlock:e.renderBlock,renderAnnotation:e.renderAnnotation})]})}function k(n){const{rows:t}=n;return o(a,{children:[l(c,{borderBottom:!0,padding:4,children:l(d,{size:4,weight:"bold",children:"Table"})}),0===t.length?l(c,{padding:4,children:l(d,{children:"EmptyTable"})}):t.map((n=>{var t;return l(m,{padding:2,children:l(s,{space:2,children:null==(t=null==n?void 0:n.cells)?void 0:t.map((n=>{var t;return l(c,{padding:4,tone:"primary",children:e(null!=(t=n.text)?t:[])},n._key)}))})},n._key)}))]})}const x=r((n=>{var t,r;const o=n.cellSchema,i=(a=o,e=>l(g,{...e,cellSchema:a}));var a;return{name:"portable-table",schema:{types:[{title:"Table Cell Body",name:"table-cell-body",type:"array",of:[o]},{title:"Table Cell",name:"table-cell",type:"object",preview:{select:{text:"text"},prepare(n){let{text:t}=n;return{title:e(null!=t?t:[])}}},fields:[{name:"text",type:"table-cell-body"}]},{title:"Table Row",name:"table-row",type:"object",preview:{select:{cells:"cells"},prepare(n){let{cells:t=[]}=n;return{title:t.map((n=>{var t;return e(null!=(t=n.text)?t:[])})).join(", ")}}},fields:[{name:"cells",type:"array",of:[{type:"table-cell"}]}]},{name:null!=(t=n.name)?t:"table",title:null!=(r=n.title)?r:"Table",type:"object",components:{preview:k,input:i},preview:{select:{rows:"rows"},prepare(e){let{rows:n=[]}=e;return{rows:n}}},fields:[{name:"num_cols",type:"number",validation:e=>e.required().min(1),initialValue:3},{name:"rows",type:"array",of:[{type:"table-row"}],initialValue:[]}]}]}}}));export{x as portableTable};//# sourceMappingURL=index.esm.js.map
