"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@portabletext/toolkit"),t=require("sanity"),n=require("react/jsx-runtime"),r=require("react"),l=require("@sanity/ui"),o=require("@sanity/icons");Object.prototype.hasOwnProperty.call.bind(Object.prototype.hasOwnProperty);const i=(()=>{let e;return()=>{if(e)return e;e=[];for(let t=0;t<256;++t)e[t]=(t+256).toString(16).substring(1);return e}})();function a(){const e=new Uint8Array(arguments.length>0&&void 0!==arguments[0]?arguments[0]:16);var t;return t=e,window.crypto.getRandomValues(t),e}function s(e){const t=i();return a(e).reduce(((e,n)=>e+t[n]),"").slice(0,e)}function c(e,t){return{_key:s(),_type:t.name,children:[{_key:s(),_type:"span",marks:[],text:e}],markDefs:[],style:"normal"}}function u(e,t){return{_key:s(),_type:"table-cell",text:[c(e,t)]}}function d(e,t){return{_key:s(),_type:"table-row",cells:Array.from(Array(e)).map(((e,n)=>u("Cell ".concat(n+1),t)))}}function p(e){var i;const{members:a,onChange:s,value:c,renderInput:p,cellSchema:m}=e,y=function(e,t){return e.find((e=>"field"===e.kind&&e.name===t))}(a,"rows"),b=r.useCallback((()=>{const e=(null==c?void 0:c.num_cols)+1||1,n=function(){let e=arguments.length>1?arguments[1]:void 0;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((t=>{const{cells:n,...r}=t;return{...r,cells:[...n,u("Cell ".concat(n.length+1),e)]}}))}(null==c?void 0:c.rows,m);s(t.set({...c,rows:n,num_cols:e}))}),[s,c,m]),x=r.useCallback((()=>{if(1===(null==c?void 0:c.num_cols))return;const e=(null==c?void 0:c.num_cols)-1||1,n=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((e=>{const{cells:t,...n}=e,r=[...t];return r.pop(),{...n,cells:r}}))}(null==c?void 0:c.rows);s(t.set({...c,rows:n,num_cols:e}))}),[s,c]),v=r.useCallback((e=>p({...e,onInsert:()=>{const{rows:e,num_cols:n}=c;return s(t.set({...c,rows:[...e,d(n,m)]}))}})),[c,s,m,p]);return n.jsxs(l.Stack,{children:[n.jsx(l.Card,{padding:1,paddingBottom:4,children:n.jsxs(l.Inline,{space:2,children:[n.jsx(l.Button,{icon:o.RemoveIcon,mode:"ghost",onClick:x}),n.jsxs(l.Text,{children:[null!=(i=null==c?void 0:c.num_cols)?i:1," ",1===(null==c?void 0:c.num_cols)?"Column":"Columns"]}),n.jsx(l.Button,{icon:o.AddIcon,tone:"primary",onClick:b})]})}),y&&n.jsx(t.MemberField,{member:y,renderInput:v,renderField:e.renderField,renderItem:e.renderItem,renderPreview:e.renderPreview,renderBlock:e.renderBlock,renderAnnotation:e.renderAnnotation})]})}function m(t){const{rows:r}=t;return n.jsxs(l.Stack,{children:[n.jsx(l.Card,{borderBottom:!0,padding:4,children:n.jsx(l.Text,{size:4,weight:"bold",children:"Table"})}),0===r.length?n.jsx(l.Card,{padding:4,children:n.jsx(l.Text,{children:"EmptyTable"})}):r.map((t=>{var r;return n.jsx(l.Box,{padding:2,children:n.jsx(l.Inline,{space:2,children:null==(r=null==t?void 0:t.cells)?void 0:r.map((t=>{var r;return n.jsx(l.Card,{padding:4,tone:"primary",children:e.toPlainText(null!=(r=t.text)?r:[])},t._key)}))})},t._key)}))]})}const y=t.definePlugin((t=>{var r,l;const o=t.cellSchema,i=(a=o,e=>n.jsx(p,{...e,cellSchema:a}));var a;return{name:"portable-table",schema:{types:[{title:"Table Cell Body",name:"table-cell-body",type:"array",of:[o]},{title:"Table Cell",name:"table-cell",type:"object",preview:{select:{text:"text"},prepare(t){let{text:n}=t;return{title:e.toPlainText(null!=n?n:[])}}},fields:[{name:"text",type:"table-cell-body"}]},{title:"Table Row",name:"table-row",type:"object",preview:{select:{cells:"cells"},prepare(t){let{cells:n=[]}=t;return{title:n.map((t=>{var n;return e.toPlainText(null!=(n=t.text)?n:[])})).join(", ")}}},fields:[{name:"cells",type:"array",of:[{type:"table-cell"}]}]},{name:null!=(r=t.name)?r:"table",title:null!=(l=t.title)?l:"Table",type:"object",components:{preview:m,input:i},preview:{select:{rows:"rows"},prepare(e){let{rows:t=[]}=e;return{rows:t}}},fields:[{name:"num_cols",type:"number",validation:e=>e.required().min(1),initialValue:3},{name:"rows",type:"array",of:[{type:"table-row"}],initialValue:[]}]}]}}}));exports.portableTable=y;//# sourceMappingURL=index.js.map
